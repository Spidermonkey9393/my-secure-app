      - name: Build Go code (required for CodeQL)
        shell: bash
        run: |
          set -e

          if [ -f go.mod ]; then
            echo "Using Go modules"
            go build ./...
          else
            echo "Using local GOPATH mode"
            export GOPATH="$PWD/.gopath"
            export GO111MODULE=off

            mkdir -p "$GOPATH/src/app"
            rsync -a . "$GOPATH/src/app/"
            cd "$GOPATH/src/app"

            go build ./...
          fi
